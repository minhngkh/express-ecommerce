<section>
  <div class="relative mx-auto max-w-screen-xl px-4 py-8">
    <div class="grid grid-cols-1 items-start gap-8 md:grid-cols-2">
      <div class="grid grid-cols-2 gap-4 md:grid-cols-1">
        <img
          alt="Les Paul"
          src="{{product.image}}"
          class="aspect-square w-full rounded-xl object-cover"
        />

        <div class="grid grid-cols-2 gap-4 lg:mt-4">
          <img
            alt="Les Paul"
            src="{{product.image}}"
            class="aspect-square w-full rounded-xl object-cover"
          />

          <img
            alt="Les Paul"
            src="{{product.image}}"
            class="aspect-square w-full rounded-xl object-cover"
          />

          <img
            alt="Les Paul"
            src="{{product.image}}"
            class="aspect-square w-full rounded-xl object-cover"
          />

          <img
            alt="Les Paul"
            src="{{product.image}}"
            class="aspect-square w-full rounded-xl object-cover"
          />
        </div>
      </div>

      <div class="sticky top-0">
        {{! <strong
          class="rounded-full border border-blue-600 bg-gray-100 px-3 py-0.5 text-xs font-medium tracking-wide text-blue-600"
        >
          Pre Order
        </strong> }}

        <div class="mt-2 flex justify-between">
          <div class="max-w-[40ch]">
            <h1 class="text-2xl font-bold">
              {{product.name}}
            </h1>

            <p class="mt-0.5 text-sm">Highest Rated Product</p>

            <div class="-ml-0.5 mt-2 flex">
              <svg
                class="h-5 w-5 text-yellow-400"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                />
              </svg>

              <svg
                class="h-5 w-5 text-yellow-400"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                />
              </svg>

              <svg
                class="h-5 w-5 text-yellow-400"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                />
              </svg>

              <svg
                class="h-5 w-5 text-yellow-400"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                />
              </svg>

              <svg
                class="h-5 w-5 text-gray-200"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                />
              </svg>
            </div>
          </div>

          <p class="text-lg font-bold">{{product.price}}</p>
        </div>

        <details
          class="group relative mt-4 [&_summary::-webkit-details-marker]:hidden"
        >
          <summary class="block">
            <div>
              <div class="prose max-w-none group-open:hidden">
                <p>
                  Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsa
                  veniam dicta beatae eos ex error culpa delectus rem tenetur,
                  architecto quam nesciunt, dolor veritatis nisi minus
                  inventore, rerum at recusandae?
                </p>
              </div>

              <span
                class="mt-4 cursor-pointer text-sm font-medium underline group-open:absolute group-open:bottom-0 group-open:left-0 group-open:mt-0"
              >
                Read More
              </span>
            </div>
          </summary>

          <div class="prose max-w-none pb-6">
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Ipsa
              veniam dicta beatae eos ex error culpa delectus rem tenetur,
              architecto quam nesciunt, dolor veritatis nisi minus inventore,
              rerum at recusandae?
            </p>

            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Placeat
              nam sapiente nobis ea veritatis error consequatur nisi
              exercitationem iure laudantium culpa, animi temporibus non! Maxime
              et quisquam amet. A, deserunt!
            </p>
          </div>
        </details>

        <form class="mt-8">
          <fieldset>
            <legend class="mb-1 text-sm font-medium">Color</legend>

            <div class="flow-root">
              <div class="-m-0.5 flex flex-wrap">
                <label for="color_tt" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="color"
                    id="color_tt"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-block rounded-full border px-3 py-1 text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    Texas Tea
                  </span>
                </label>

                <label for="color_fr" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="color"
                    id="color_fr"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-block rounded-full border px-3 py-1 text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    Fiesta Red
                  </span>
                </label>

                <label for="color_cb" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="color"
                    id="color_cb"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-block rounded-full border px-3 py-1 text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    Cobalt Blue
                  </span>
                </label>
              </div>
            </div>
          </fieldset>

          {{! <fieldset class="mt-4">
            <legend class="mb-1 text-sm font-medium">Size</legend>

            <div class="flow-root">
              <div class="-m-0.5 flex flex-wrap">
                <label for="size_xs" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="size"
                    id="size_xs"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    XS
                  </span>
                </label>

                <label for="size_s" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="size"
                    id="size_s"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    S
                  </span>
                </label>

                <label for="size_m" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="size"
                    id="size_m"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    M
                  </span>
                </label>

                <label for="size_l" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="size"
                    id="size_l"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    L
                  </span>
                </label>

                <label for="size_xl" class="cursor-pointer p-0.5">
                  <input
                    type="radio"
                    name="size"
                    id="size_xl"
                    class="peer sr-only"
                  />

                  <span
                    class="group inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-medium peer-checked:bg-black peer-checked:text-white"
                  >
                    XL
                  </span>
                </label>
              </div>
            </div>
          </fieldset> }}

          <div class="mt-8 flex">
            <div>
              <label for="quantity" class="sr-only">Qty</label>

              <input
                type="number"
                id="quantity"
                min="1"
                value="1"
                class="w-12 rounded border-gray-200 py-3 text-center text-xs [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
              />
            </div>

            <button
              type="submit"
              class="ml-3 block rounded bg-teal-600 px-5 py-3 text-xs font-medium text-white hover:bg-teal-700"
            >
              Add to Cart
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Product Details -->
    <div class="mt-8 grid grid-cols-1 gap-8 md:grid-cols-2">
      <div class="max-w-1xl prose">
        <p>
          Lorem ipsum dolor sit amet consectetur adipisicing elit. Molestiae
          tempora possimus temporibus obcaecati quisquam itaque odio, iure cum,
          quam cupiditate error odit quos commodi est magnam iusto, consequatur
          sint aspernatur laboriosam mollitia delectus et tenetur maiores! Culpa
          nemo vero veniam dolor nihil, unde quia doloribus possimus vel
          blanditiis harum cumque.
        </p>
      </div>
      <div class="flow-root rounded-lg border border-gray-100 py-3 shadow-sm">
        <dl class="-my-3 divide-y divide-gray-100 text-sm">
          <div
            class="grid grid-cols-1 gap-1 p-3 even:bg-gray-50 sm:grid-cols-3 sm:gap-4"
          >
            <dt class="font-medium text-gray-900">Brand</dt>
            <dd class="text-gray-700 sm:col-span-2">{{product.brand}}</dd>
          </div>

          <div
            class="grid grid-cols-1 gap-1 p-3 even:bg-gray-50 sm:grid-cols-3 sm:gap-4"
          >
            <dt class="font-medium text-gray-900">Resolution</dt>
            <dd class="text-gray-700 sm:col-span-2">{{product.resolution}}</dd>
          </div>

          <div
            class="grid grid-cols-1 gap-1 p-3 even:bg-gray-50 sm:grid-cols-3 sm:gap-4"
          >
            <dt class="font-medium text-gray-900">CPU</dt>
            <dd class="text-gray-700 sm:col-span-2">{{product.cpu}}</dd>
          </div>

          <div
            class="grid grid-cols-1 gap-1 p-3 even:bg-gray-50 sm:grid-cols-3 sm:gap-4"
          >
            <dt class="font-medium text-gray-900">RAM</dt>
            <dd class="text-gray-700 sm:col-span-2">{{product.ram}}</dd>
          </div>

          <div
            class="grid grid-cols-1 gap-1 p-3 even:bg-gray-50 sm:grid-cols-3 sm:gap-4"
          >
            <dt class="font-medium text-gray-900">Storage</dt>
            <dd class="text-gray-700 sm:col-span-2">{{product.storage}}</dd>
          </div>
        </dl>
      </div>
    </div>
    <!-- Product Details -->

  </div>

  <div class="mx-auto max-w-screen-xl px-4 py-8 sm:px-6 sm:py-12 lg:px-8">
    <header>
      <h2 class="text-xl font-bold text-gray-900 sm:text-3xl">Related products</h2>
    </header>

    <ul class="mt-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
      {{#each relatedProducts}}
        <li>
          <a
            href="/products/laptops/{{id}}"
            class="group block overflow-hidden"
          >
            <img
              src="{{image}}"
              alt=""
              class="aspect-square object-cover transition duration-500 group-hover:scale-105 xsm:max-h-60"
            />

            <div class="relative bg-white pt-3">
              <h3
                class="text-xs text-gray-700 group-hover:underline group-hover:underline-offset-4"
              >
                {{name}}
              </h3>

              <p class="mt-2">
                <span class="sr-only"> Regular Price </span>

                <span class="tracking-wider text-gray-900">
                  {{price}}</span>
              </p>
            </div>
          </a>
        </li>
      {{/each}}
    </ul>

  </div>

  <!-- Customer Reviews -->
  <div
    x-data="{ avgRating: {{nullSafe reviews.avgRating}} }"
    class="mx-auto max-w-screen-xl px-4 py-8 sm:px-6 lg:px-8"
  >
    <h2 class="text-xl font-bold sm:text-2xl">Customer Reviews</h2>

    <div x-show="avgRating">
      <div class="mt-4 flex items-center">
        <p x-text="avgRating" class="mr-2 text-3xl font-medium">
          <span class="sr-only"> Average review score </span>
        </p>

        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-8 w-8 text-yellow-400"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
          ></path>
        </svg>
      </div>

      <div class="mt-8 grid grid-cols-1 gap-x-16 gap-y-12 lg:grid-cols-2">
        {{#each reviews.others}}
          <blockquote>
            <header class="sm:flex sm:items-center">
              <span class="mr-1 text-sm text-gray-600">{{rating}}</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-yellow-400"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                ></path>
              </svg>
            </header>

            <p class="mt-2 text-gray-700">
              {{comment}}
            </p>

            <footer class="gap mt-4">
              <span class="text-xs text-gray-500">{{name}}</span>
              {{#if time}}
                <span class="mx-2 text-xs text-gray-400">|</span>
                <span
                  x-text="toLocalDate('{{time}}')"
                  class="text-xs text-gray-500"
                ></span>
              {{/if}}
            </footer>
          </blockquote>
        {{/each}}

      </div>
    </div>

    <div x-show="!avgRating">
      <p class="mt-4 text-gray-700">No reviews yet.</p>
    </div>

  </div>

  <!-- User Review -->
  {{#if user}}
    <div class="mx-auto max-w-screen-md px-4 py-8 sm:px-6 lg:px-8">
      <h3 class="font-semibold">Your review:</h3>

      <!-- Current Review -->
      <div x-show="!$store.userReview.showInputArea">
        <blockquote class="mx-0.5 my-2">
          <header class="sm:flex sm:items-center">
            <span
              x-text="$store.userReview.rating"
              class="mr-1 text-sm text-gray-600"
            ></span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-yellow-400"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
              ></path>
            </svg>
          </header>

          <p x-text="$store.userReview.comment" class="mt-2 text-gray-700">
          </p>

          <footer class="gap mt-4">
            <span class="text-xs text-gray-500">{{user.fullName}}</span>
            <span class="mx-2 text-xs text-gray-400">|</span>
            <span
              x-text="toLocalDate($store.userReview.time)"
              class="text-xs text-gray-500"
            ></span>
          </footer>
        </blockquote>

        <div class="flex items-center justify-center gap-3">
          <button
            @click="$store.userReview.delete()"
            class="rounded bg-gray-100 px-3 py-1.5 text-sm font-medium text-teal-600 hover:bg-gray-200"
          >
            Delete
          </button>
          <button
            @click="$store.userReview.showInputArea = true"
            class="rounded bg-teal-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-teal-700"
          >
            Edit
          </button>
        </div>
      </div>
      <!-- Current Review -->

      <!-- User Review Input -->
      <template x-if="$store.userReview.showInputArea">
        <form id="reviewForm" class="my-2">
          <div>
            <label for="comment" class="sr-only">Comment</label>

            <div
              class="overflow-hidden rounded-lg border border-gray-200 shadow-sm focus-within:border-teal-600 focus-within:ring-1 focus-within:ring-teal-600 dark:border-gray-700"
            >
              <textarea
                x-model="$store.userReview.input.comment"
                id="comment"
                name="comment"
                class="w-full resize-none border-none align-top focus:ring-0 dark:bg-gray-800 dark:text-white sm:text-sm"
                rows="4"
                placeholder="Enter your review..."
              ></textarea>

              <div
                class="flex items-center justify-between gap-2 bg-white p-3 dark:bg-gray-800"
              >
                <label for="rating">
                  <div
                    x-data="{ 
                      hoverRating: 0, 
                      rate(amount) {
                        $store.userReview.input.rating = $store.userReview.input.rating == amount ? 0 : amount 
                      } 
                    }"
                  >
                    <div class="">
                      <template x-for="stars in 5" :key="stars">
                        <button
                          @click="rate(stars)"
                          @mouseover="hoverRating = stars"
                          @mouseleave="hoverRating = $store.userReview.input.rating"
                          type="button"
                          aria-hidden="true"
                          class="m-0 cursor-pointer fill-current p-0.5"
                          :class="$store.userReview.input.rating >= stars || hoverRating >= stars ? 'text-yellow-400' : 'text-gray-400'"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 transition duration-150"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                            ></path>
                          </svg>
                        </button>

                      </template>
                    </div>
                  </div>
                </label>
                <input
                  x-model="$store.userReview.input.rating"
                  name="rating"
                  class="hidden"
                />

                <div class="flex gap-3">
                  <button
                    @click="
                      $store.userReview.showInputArea = false; 
                      $store.userReview.updateInput();
                    "
                    x-show="$store.userReview.exists"
                    type="button"
                    class="rounded bg-gray-100 px-3 py-1.5 text-sm font-medium text-teal-600 hover:bg-gray-200"
                  >
                    Cancel
                  </button>

                  <button
                    @click.prevent="$store.userReview.submit()"
                    :disabled="!$store.userReview.validateInput()"
                    type="submit"
                    class="rounded px-3 py-1.5 text-sm font-medium text-white enabled:bg-teal-600 enabled:hover:bg-teal-700 disabled:cursor-not-allowed disabled:bg-teal-800"
                  >
                    Submit
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </template>
      <!-- User Review Input -->
    </div>
  {{/if}}
  <!-- User Review -->
</section>

{{! prettier-ignore}}
{{#content "script"}}
  <script>

    {{#if user}}
      const productId = {{product.id}};
      const user = {
        id: {{user.id}},
        fullName: "{{user.fullName}}",
      };    

      document.addEventListener("alpine:init",  () => {
        Alpine.store("userReview", {
          {{#with reviews.user}}
            
            init() {
                this.exists = true;
                this.rating = this.input.rating = {{rating}};
                this.comment = this.input.comment = `{{comment}}`;
                this.time = `{{time}}`;

                this.showInputArea = false;
            },
          {{/with}}

          exists: false,
          rating: null,
          comment: "",
          time: "",

          input: {
            rating: null,
            comment: "",
          },

          showInputArea: true,

          updateInput() {
            this.input.rating = this.rating;
            this.input.comment = this.comment;
          },

          validateInput() {
            return this.input.rating && this.input.comment;
          },

          async delete() {
            try {
              const response = await fetch(
                `/api/products/${productId}/reviews/${user.id}`, 
                {
                  method: "DELETE",
                },
              );

              if (!response.ok) {
                throw new Error(response.body);
              }

              this.exists = false;
              this.rating = 0;
              this.comment = "";
              this.time = "";

              this.updateInput();

              this.showInputArea = true;
              return true;
            } catch (err) {
              console.log(err);
              return false;
            }
          },

          async submit() {
            try {
              const response = await fetch(
                `/api/products/${productId}/reviews/${this.exists ? user.id : ""}`,
                {
                  method: this.exists ? "PUT" : "POST",
                  headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                  },
                  body: new URLSearchParams({
                    userId: user.id,
                    rating: this.input.rating,
                    comment: this.input.comment,
                  }),
                }
              );

              if (!response.ok) {
                throw new Error(response.body);
              }

              const data = await response.json();

              this.exists = true;
              this.time = data["time"];
              this.rating = this.input.rating;
              this.comment = this.input.comment;

              this.showInputArea = false;
              return true;
            } catch (err) {
              console.log(err);
              return false;
            }
          },
        });
      });
    {{/if}}

    const toLocalDate = (time) => {
      if (!time) {
        return "";
      }

      const date = new Date(time);
      return date.toISOString().split('T')[0];
    }
    
  </script>
{{/content}}